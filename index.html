<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Theo dõi OTP</title>
</head>
<body>
  <h2>Theo dõi OTP Gmail / Outlook</h2>
  <form id="otpForm">
    <input type="email" name="email" placeholder="Nhập email" required /><br><br>
    <input type="number" name="duration" placeholder="Thời gian (phút)" value="10" required /><br><br>
    <button type="submit">Bắt đầu</button>
  </form>
  <pre id="status"></pre>

  <script>
    const form = document.getElementById("otpForm");
    const status = document.getElementById("status");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const formData = new FormData(form);
      const email = formData.get("email");
      const duration = formData.get("duration");

      status.textContent = "⏳ Đang xử lý...";

      try {
        const res = await fetch("https://otpwatcherapi.up.railway.app/api/start", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ email, duration })
        });

        const text = await res.text();
        status.textContent = text;

        // Nếu Gmail, sẽ bị redirect → hiển thị dạng text
        if (res.redirected) {
          window.location.href = res.url;
        }
      } catch (err) {
        status.textContent = "❌ Lỗi gửi yêu cầu: " + err.message;
      }
    });
  </script>
</body>
</html>
